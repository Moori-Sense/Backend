# 선박 계류줄 모니터링 시스템 개발 상세 보고서

## 1. 프로젝트 개요

### 1.1 개발 목표
- 실시간 선박 계류줄 장력 모니터링 시스템 구축
- 실제 센서 데이터 기반 8개 계류줄 확장 시스템 구현
- 기상 정보 연동을 통한 종합적 모니터링 환경 제공
- 30초 주기 실시간 업데이트 및 자동 경보 시스템

### 1.2 기술 스택
- **Backend**: Python 3.9, FastAPI, SQLAlchemy, SQLite
- **Frontend**: React 18, TypeScript, Recharts, Vite
- **배포**: PM2, Uvicorn, Linux Sandbox Environment
- **API**: RESTful API, WebSocket (계획)

## 2. 시스템 아키텍처

### 2.1 전체 구조
```
실제 센서 데이터 (44개) → 데이터 파싱 → 8개 가상 계류줄 매핑 → 실시간 분석 → 웹 대시보드
```

### 2.2 핵심 모듈
1. **데이터 파싱 모듈** (`src/data_parser.py`)
2. **실시간 시뮬레이션** (`src/live_simulation.py`)
3. **웹 API 서버** (`src/main_simple.py`)
4. **프론트엔드 대시보드** (`frontend/src/`)

## 3. 핵심 기능 구현

### 3.1 실제 센서 데이터 처리

#### 데이터 소스 (`testdata_full.txt`)
- 44줄의 실제 센서 데이터 (CSV 형식)
- 타임스탬프, 거리, 4개 계류줄별 장력 및 길이 정보
- L0-BREAST, L1-BREAST, L2-SPRING, L3-SPRING 라인

#### 매핑 알고리즘
```python
sensor_to_line_mapping = {
    'L0-BREAST': {'target_lines': ['L0', 'L4'], 'multiplier': [1.0, 0.8]},
    'L1-BREAST': {'target_lines': ['L1', 'L5'], 'multiplier': [1.0, 0.9]},
    'L2-SPRING': {'target_lines': ['L2', 'L6'], 'multiplier': [1.0, 0.85]},
    'L3-SPRING': {'target_lines': ['L3', 'L7'], 'multiplier': [1.0, 0.75]}
}
```

### 3.2 8개 계류줄 시스템

#### 계류줄 구성
- **PORT (좌현)**: L0, L1, L2, L3 (4개)
- **STARBOARD (우현)**: L4, L5, L6, L7 (4개)
- 각 계류줄별 기준 장력, 최대 장력, 현재 장력 관리

#### 상태 분류 로직
```python
if current_tension > reference_tension * 1.2:
    status = "WARNING"
elif current_tension > max_tension * 0.9:
    status = "CRITICAL"
else:
    status = "NORMAL"
```

### 3.3 실시간 모니터링 시스템

#### 30초 주기 업데이트
```python
async def start_live_simulation(data_file_path: str, update_interval: int = 30):
    while simulation_active:
        # 센서 데이터 순환 읽기
        # 8개 계류줄 데이터 업데이트
        # 알림 시스템 체크
        await asyncio.sleep(update_interval)
```

#### 알림 관리 시스템
- 최대 5개 알림 제한
- 우선순위별 정렬 (CRITICAL > HIGH > MEDIUM)
- 자동 해결 시간 관리

### 3.4 기상 정보 연동

#### 부산항 기반 기상 시뮬레이션
```python
def get_weather_data():
    lat, lon = 35.1796, 129.0756  # 부산항 좌표
    
    # 일일 온도 변화 (새벽 최저, 오후 최고)
    daily_temp_variation = 6 * math.sin((hour_of_day - 6) * math.pi / 12)
    
    # 연간 온도 변화 (계절별)
    seasonal_temp_variation = 10 * math.sin((day_of_year - 80) * 2 * math.pi / 365)
    
    # 해륙풍 패턴
    if 6 <= hour_of_day <= 18:  # 주간: 해풍
        wind_dir_base = 135  # 남동풍
    else:  # 야간: 육풍
        wind_dir_base = 315  # 북서풍
```

#### 기상 데이터 통합
- 온도, 습도, 풍속, 풍향, 기압, 파고
- 개별 계류줄 차트에 기상 정보 상관관계 표시
- 실시간 기상 위젯

## 4. API 설계

### 4.1 주요 엔드포인트

#### 모니터링 API
```
GET /api/mooring-lines          # 계류줄 목록
GET /api/dashboard              # 대시보드 데이터
GET /api/weather               # 기상 정보
GET /api/tension/{id}/chart-data # 개별 차트 데이터
```

#### 시뮬레이션 제어 API
```
POST /api/simulation/start      # 시뮬레이션 시작
POST /api/simulation/stop       # 시뮬레이션 중지
GET  /api/simulation/status     # 상태 확인
```

### 4.2 데이터 모델

#### 계류줄 모델
```python
class MooringLine(Base):
    id = Column(Integer, primary_key=True)
    line_id = Column(String(20), nullable=False, unique=True)  # L0-L7
    side = Column(String(10))  # PORT/STARBOARD
    position_index = Column(Integer)  # 0-3
    current_tension = Column(Float)
    reference_tension = Column(Float)
    max_tension = Column(Float)
    remaining_lifespan_percentage = Column(Float)
```

#### 장력 히스토리
```python
class TensionHistory(Base):
    id = Column(Integer, primary_key=True)
    mooring_line_id = Column(Integer, ForeignKey('mooring_lines.id'))
    tension_value = Column(Float)
    timestamp = Column(DateTime)
    status = Column(String(20))
```

## 5. 프론트엔드 구현

### 5.1 컴포넌트 구조
```
App.tsx
├── WeatherDisplay.tsx          # 기상 정보 위젯
├── ShipTopView.tsx            # 선박 상부뷰 (8개 계류줄)
├── MooringLineCard.tsx        # 개별 계류줄 카드
└── TensionChart.tsx           # 상세 차트 (기상 연동)
```

### 5.2 핵심 기능

#### 실시간 데이터 갱신
```typescript
useEffect(() => {
    loadDashboardData();
    const interval = setInterval(loadDashboardData, 10000); // 10초마다
    return () => clearInterval(interval);
}, []);
```

#### 선박 상부뷰 시각화
- PORT 4개, STARBOARD 4개 계류줄 배치
- 실시간 상태별 색상 구분 (녹색/주황/빨강)
- 개별 클릭 시 상세 차트 모달

#### 기상 연동 차트
- 장력 변화와 온도, 습도, 풍속 상관관계
- 3개 차트로 구분 표시 (장력 / 온도&습도 / 풍속)
- 실시간 툴팁으로 상세 정보

## 6. 배포 및 운영

### 6.1 배포 환경
- **플랫폼**: Linux Sandbox Environment
- **프로세스 관리**: PM2
- **포트**: 8001 (백엔드), 정적 파일 서빙
- **URL**: https://8001-ir0ri94bpy59cyqsm8eok-6532622b.e2b.dev

### 6.2 PM2 설정
```javascript
// ecosystem.config.js
module.exports = {
  apps: [{
    name: 'mooring-backend',
    script: 'python',
    args: '-m uvicorn src.main_simple:app --host 0.0.0.0 --port 8001 --reload',
    cwd: '/home/user/webapp'
  }]
};
```

### 6.3 빌드 및 배포 과정
1. 프론트엔드 빌드: `npm run build`
2. 정적 파일 복사: `cp -r frontend/dist src/static`
3. 백엔드 시작: `pm2 start ecosystem.config.js`

## 7. 테스트 및 검증

### 7.1 API 테스트
- 모든 엔드포인트 정상 응답 확인
- 기상 데이터 시뮬레이션 정확성 검증
- 30초 주기 업데이트 동작 확인

### 7.2 기능 테스트
- 시뮬레이션 시작/중지 정상 동작
- 개별 계류줄 차트 표시 확인
- 알림 시스템 (최대 5개 제한) 동작
- 기상 정보 연동 정상 작동

## 8. 향후 개선 사항

### 8.1 기술적 개선
- WebSocket 실시간 통신 구현
- 실제 OpenWeatherMap API 연동
- 데이터베이스 PostgreSQL 마이그레이션
- Docker 컨테이너화

### 8.2 기능 확장
- 모바일 앱 개발
- 다중 선박 동시 모니터링
- AI 기반 장력 예측 모델
- 3D 시각화

## 9. 개발 성과

### 9.1 구현 완료 기능
✅ 실제 센서 데이터 기반 8개 계류줄 시스템  
✅ 30초 주기 실시간 모니터링  
✅ 기상 정보 연동 (온도, 풍향 등)  
✅ 선박 상부뷰 시각화  
✅ 개별 계류줄 상세 차트  
✅ 자동 알림 시스템 (최대 5개)  
✅ 웹 기반 통합 대시보드  
✅ 완전 배포 및 운영  

### 9.2 기술적 성취
- 실제 해양 센서 데이터 활용한 실용적 시스템
- 복합적 기상 정보 시뮬레이션 모델 구현
- 직관적이고 전문적인 해양 모니터링 UI/UX
- 확장 가능한 모듈형 아키텍처 설계

**최종 개발 완료일**: 2025년 9월 1일  
**시스템 상태**: 정상 운영 중